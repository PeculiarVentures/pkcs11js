<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>pkcs11js</title>
	<meta name="description" content="Documentation for pkcs11js">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">pkcs11js</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>pkcs11js</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#pkcs11js" id="pkcs11js" style="color: inherit; text-decoration: none;">
					<h1>PKCS11js</h1>
				</a>
				<p><a href="https://raw.githubusercontent.com/PeculiarVentures/graphene/master/LICENSE"><img src="https://img.shields.io/badge/license-MIT-green.svg?style=flat" alt="license"></a>
					<img src="https://github.com/PeculiarVentures/pkcs11js/workflows/test/badge.svg" alt="test">
					<a href="https://coveralls.io/github/PeculiarVentures/pkcs11js?branch=master"><img src="https://coveralls.io/repos/github/PeculiarVentures/pkcs11js/badge.svg?branch=master" alt="Coverage Status"></a>
				<a href="https://badge.fury.io/js/pkcs11js"><img src="https://badge.fury.io/js/pkcs11js.svg" alt="npm version"></a></p>
				<p><a href="https://nodei.co/npm/pkcs11js/"><img src="https://nodei.co/npm/pkcs11js.png" alt="NPM"></a></p>
				<p>We make a package called <a href="https://github.com/PeculiarVentures/graphene">Graphene</a>, it provides a simplistic Object Oriented interface for interacting with PKCS#11 devices, for most people this is the right level to build on. In some cases you may want to interact directly with the PKCS#11 API, if so PKCS11js is the package for you.</p>
				<p>PKCS#11 (also known as CryptoKI or PKCS11) is the standard interface for interacting with hardware crypto devices such as Smart Cards and Hardware Security Modules (HSMs). </p>
				<p>This was developed to the PKCS#11 2.30 specification, the 2.40 headers were not available at the time we created this, it should be easy enough to extend it for the new version at a later date.</p>
				<p>It has been tested with :</p>
				<ul>
					<li><a href="https://www.opendnssec.org/softhsm/">SoftHSM2</a></li>
					<li><a href="https://www.thales-esecurity.com/products-and-services/products-and-services/hardware-security-modules/general-purpose-hsms/nshield-solo">Thales NShield</a></li>
					<li><a href="http://www.safenet-inc.com/">Safenet Luna HSMs</a></li>
					<li><a href="http://www.rutoken.ru/">RuToken</a></li>
				</ul>
				<p><strong>NOTE:</strong> For testing purposes it may be easier to work with SoftHSM2 which is a software implementation of PKCS#11 based on OpenSSL or Botan.</p>
				<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
					<h2>Installation</h2>
				</a>
				<pre><code>$ npm <span class="hljs-keyword">install</span> pkcs11js</code></pre>
				<a href="#documentation" id="documentation" style="color: inherit; text-decoration: none;">
					<h2>Documentation</h2>
				</a>
				<p><a href="https://peculiarventures.github.io/pkcs11js/">https://peculiarventures.github.io/pkcs11js/</a></p>
				<a href="#install-softhsm2" id="install-softhsm2" style="color: inherit; text-decoration: none;">
					<h3>Install SoftHSM2</h3>
				</a>
				<ul>
					<li>For OSX see the <a href="https://github.com/opendnssec/SoftHSMv2/blob/develop/OSX-NOTES.md">instructions here</a></li>
					<li>For linux <a href="https://github.com/opendnssec/SoftHSMv2/blob/develop/README.md">instructions here</a></li>
					<li>For Windows <a href="https://github.com/disig/SoftHSM2-for-Windows#softhsm2-installer-for-ms-windows">instructions here</a></li>
				</ul>
				<a href="#examples" id="examples" style="color: inherit; text-decoration: none;">
					<h2>Examples</h2>
				</a>
				<a href="#example-1" id="example-1" style="color: inherit; text-decoration: none;">
					<h3>Example #1</h3>
				</a>
				<pre><code class="language-javascript"><span class="hljs-keyword">var</span> pkcs11js = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;pkcs11js&quot;</span>);

<span class="hljs-keyword">var</span> pkcs11 = <span class="hljs-keyword">new</span> pkcs11js.PKCS11();
pkcs11.load(<span class="hljs-string">&quot;/usr/local/lib/softhsm/libsofthsm2.so&quot;</span>);

pkcs11.C_Initialize();

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// Getting info about PKCS11 Module</span>
    <span class="hljs-keyword">var</span> module_info = pkcs11.C_GetInfo();

    <span class="hljs-comment">// Getting list of slots</span>
    <span class="hljs-keyword">var</span> slots = pkcs11.C_GetSlotList(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">var</span> slot = slots[<span class="hljs-number">0</span>];

    <span class="hljs-comment">// Getting info about slot</span>
    <span class="hljs-keyword">var</span> slot_info = pkcs11.C_GetSlotInfo(slot);
    <span class="hljs-comment">// Getting info about token</span>
    <span class="hljs-keyword">var</span> token_info = pkcs11.C_GetTokenInfo(slot);

    <span class="hljs-comment">// Getting info about Mechanism</span>
    <span class="hljs-keyword">var</span> mechs = pkcs11.C_GetMechanismList(slot);
    <span class="hljs-keyword">var</span> mech_info = pkcs11.C_GetMechanismInfo(slot, mechs[<span class="hljs-number">0</span>]);

    <span class="hljs-keyword">var</span> session = pkcs11.C_OpenSession(slot, pkcs11js.CKF_RW_SESSION | pkcs11js.CKF_SERIAL_SESSION);

    <span class="hljs-comment">// Getting info about Session</span>
    <span class="hljs-keyword">var</span> info = pkcs11.C_GetSessionInfo(session);
    pkcs11.C_Login(session, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;password&quot;</span>);

    <span class="hljs-comment">/**
     * Your app code here
     */</span>

    pkcs11.C_Logout(session);
    pkcs11.C_CloseSession(session);
}
<span class="hljs-keyword">catch</span>(e){
    <span class="hljs-built_in">console</span>.error(e);
}
<span class="hljs-keyword">finally</span> {
    pkcs11.C_Finalize();
}</code></pre>
				<a href="#example-2" id="example-2" style="color: inherit; text-decoration: none;">
					<h3>Example #2</h3>
				</a>
				<p>Generating secret key using AES mechanism</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">var</span> template = [
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_CLASS, <span class="hljs-attr">value</span>: pkcs11js.CKO_SECRET_KEY },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_TOKEN, <span class="hljs-attr">value</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL, <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;My AES Key&quot;</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_VALUE_LEN, <span class="hljs-attr">value</span>: <span class="hljs-number">256</span> / <span class="hljs-number">8</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_ENCRYPT, <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_DECRYPT, <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> },
];
<span class="hljs-keyword">var</span> key = pkcs11.C_GenerateKey(session, { <span class="hljs-attr">mechanism</span>: pkcs11js.CKM_AES_KEY_GEN }, template);</code></pre>
				<a href="#example-3" id="example-3" style="color: inherit; text-decoration: none;">
					<h3>Example #3</h3>
				</a>
				<p>Generating key pair using RSA-PKCS1 mechanism</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">var</span> publicKeyTemplate = [
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_CLASS, <span class="hljs-attr">value</span>: pkcs11js.CKO_PUBLIC_KEY },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_TOKEN, <span class="hljs-attr">value</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL, <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;My RSA Public Key&quot;</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_PUBLIC_EXPONENT, <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> Buffer([<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]) },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_MODULUS_BITS, <span class="hljs-attr">value</span>: <span class="hljs-number">2048</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_VERIFY, <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> }
];
<span class="hljs-keyword">var</span> privateKeyTemplate = [
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_CLASS, <span class="hljs-attr">value</span>: pkcs11js.CKO_PRIVATE_KEY },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_TOKEN, <span class="hljs-attr">value</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL, <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;My RSA Private Key&quot;</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_SIGN, <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> },
];
<span class="hljs-keyword">var</span> keys = pkcs11.C_GenerateKeyPair(session, { <span class="hljs-attr">mechanism</span>: pkcs11js.CKM_RSA_PKCS_KEY_PAIR_GEN }, publicKeyTemplate, privateKeyTemplate);</code></pre>
				<a href="#example-4" id="example-4" style="color: inherit; text-decoration: none;">
					<h3>Example #4</h3>
				</a>
				<p>Generating key pair using ECDSA mechanism</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">var</span> publicKeyTemplate = [
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_CLASS, <span class="hljs-attr">value</span>: pkcs11js.CKO_PUBLIC_KEY },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_TOKEN, <span class="hljs-attr">value</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL, <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;My EC Public Key&quot;</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_EC_PARAMS, <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">&quot;06082A8648CE3D030107&quot;</span>, <span class="hljs-string">&quot;hex&quot;</span>) }, <span class="hljs-comment">// secp256r1</span>
];
<span class="hljs-keyword">var</span> privateKeyTemplate = [
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_CLASS, <span class="hljs-attr">value</span>: pkcs11js.CKO_PRIVATE_KEY },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_TOKEN, <span class="hljs-attr">value</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL, <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;My EC Private Key&quot;</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_DERIVE, <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> },
];
<span class="hljs-keyword">var</span> keys = pkcs11.C_GenerateKeyPair(session, { <span class="hljs-attr">mechanism</span>: pkcs11js.CKM_EC_KEY_PAIR_GEN }, publicKeyTemplate, privateKeyTemplate);</code></pre>
				<a href="#example-4-1" id="example-4-1" style="color: inherit; text-decoration: none;">
					<h3>Example #4</h3>
				</a>
				<p>Working with Object</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">var</span> nObject = pkcs11.C_CreateObject(session, [
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_CLASS, <span class="hljs-attr">value</span>: pkcs11js.CKO_DATA },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_TOKEN, <span class="hljs-attr">value</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_PRIVATE, <span class="hljs-attr">value</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL, <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;My custom data&quot;</span> },
]);

<span class="hljs-comment">// Updating label of Object</span>
pkcs11.C_SetAttributeValue(session, nObject, [{ <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL, <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;My custom data!!!&quot;</span> }]);

<span class="hljs-comment">// Getting attribute value</span>
<span class="hljs-keyword">var</span> label = pkcs11.C_GetAttributeValue(session, nObject, [
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL },
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_TOKEN }
]);
<span class="hljs-built_in">console</span>.log(label[<span class="hljs-number">0</span>].value.toString()); <span class="hljs-comment">// My custom data!!!</span>
<span class="hljs-built_in">console</span>.log(!!label[<span class="hljs-number">1</span>].value[<span class="hljs-number">0</span>]); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// Copying Object</span>
<span class="hljs-keyword">var</span> cObject = pkcs11.C_CopyObject(session, nObject, [
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_CLASS},
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_TOKEN},
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_PRIVATE},
    { <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL},
]);

<span class="hljs-comment">// Removing Object</span>
pkcs11.C_DestroyObject(session, cObject);</code></pre>
				<a href="#example-4-2" id="example-4-2" style="color: inherit; text-decoration: none;">
					<h3>Example #4</h3>
				</a>
				<p>Searching objects</p>
				<p><strong>NOTE:</strong> If template is not set for C_FindObjectsInit, then C_FindObjects returns all objects from slot  </p>
				<pre><code class="language-javascript">pkcs11.C_FindObjectsInit(session, [{ <span class="hljs-attr">type</span>: pkcs11js.CKA_CLASS, <span class="hljs-attr">value</span>: pkcs11js.CKO_DATA }]);
<span class="hljs-keyword">var</span> hObject = pkcs11.C_FindObjects(session);
<span class="hljs-keyword">while</span> (hObject) {
    <span class="hljs-keyword">var</span> attrs = pkcs11.C_GetAttributeValue(session, hObject, [
        { <span class="hljs-attr">type</span>: pkcs11js.CKA_CLASS },
        { <span class="hljs-attr">type</span>: pkcs11js.CKA_TOKEN },
        { <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL }
    ]);
    <span class="hljs-comment">// Output info for objects from token only</span>
    <span class="hljs-keyword">if</span> (attrs[<span class="hljs-number">1</span>].value[<span class="hljs-number">0</span>]){
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Object #<span class="hljs-subst">${hObject}</span>: <span class="hljs-subst">${attrs[<span class="hljs-number">2</span>].value.toString()}</span>`</span>);
    }
    hObject = pkcs11.C_FindObjects(session);
}
pkcs11.C_FindObjectsFinal(session);</code></pre>
				<a href="#example-5" id="example-5" style="color: inherit; text-decoration: none;">
					<h3>Example #5</h3>
				</a>
				<p>Generating random values</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">var</span> random = pkcs11.C_GenerateRandom(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">20</span>));
<span class="hljs-built_in">console</span>.log(random.toString(<span class="hljs-string">&quot;hex&quot;</span>));</code></pre>
				<p>or</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">var</span> random = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">20</span>);
pkcs11.C_GenerateRandom(session, random);
<span class="hljs-built_in">console</span>.log(random.toString(<span class="hljs-string">&quot;hex&quot;</span>));</code></pre>
				<a href="#example-6" id="example-6" style="color: inherit; text-decoration: none;">
					<h3>Example #6</h3>
				</a>
				<p>Digest</p>
				<pre><code class="language-javascript">pkcs11.C_DigestInit(_session, { <span class="hljs-attr">mechanism</span>: pkcs11js.CKM_SHA256 });

pkcs11.C_DigestUpdate(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">&quot;Incoming message 1&quot;</span>));
pkcs11.C_DigestUpdate(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">&quot;Incoming message N&quot;</span>));

<span class="hljs-keyword">var</span> digest = pkcs11.C_DigestFinal(_session, Buffer(<span class="hljs-number">256</span> / <span class="hljs-number">8</span>));

<span class="hljs-built_in">console</span>.log(digest.toString(<span class="hljs-string">&quot;hex&quot;</span>));</code></pre>
				<a href="#example-7" id="example-7" style="color: inherit; text-decoration: none;">
					<h3>Example #7</h3>
				</a>
				<p>Signing data</p>
				<pre><code class="language-javascript">pkcs11.C_SignInit(session, { <span class="hljs-attr">mechanism</span>: pkcs11js.CKM_SHA256_RSA_PKCS }, keys.privateKey);

pkcs11.C_SignUpdate(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">&quot;Incoming message 1&quot;</span>));
pkcs11.C_SignUpdate(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">&quot;Incoming message N&quot;</span>));

<span class="hljs-keyword">var</span> signature = pkcs11.C_SignFinal(session, Buffer(<span class="hljs-number">256</span>));</code></pre>
				<p>Verifying data</p>
				<pre><code class="language-javascript">pkcs11.C_VerifyInit(session, { <span class="hljs-attr">mechanism</span>: pkcs11js.CKM_SHA256_RSA_PKCS }, keys.publicKey);

pkcs11.C_VerifyUpdate(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">&quot;Incoming message 1&quot;</span>));
pkcs11.C_VerifyUpdate(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">&quot;Incoming message N&quot;</span>));

<span class="hljs-keyword">var</span> verify = pkcs11.C_VerifyFinal(session, signature);</code></pre>
				<a href="#example-8" id="example-8" style="color: inherit; text-decoration: none;">
					<h3>Example #8</h3>
				</a>
				<p>Encrypting data with AES-CBC mechanism</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">var</span> cbc_param = pkcs11.C_GenerateRandom(<span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">16</span>));

pkcs11.C_EncryptInit(
    session,
    {
        <span class="hljs-attr">mechanism</span>: pkcs11js.CKM_AES_CBC,
        <span class="hljs-attr">parameter</span>: cbc_param
    },
    secretKey
);

<span class="hljs-keyword">var</span> enc = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">0</span>);
enc = Buffer.concat([enc, pkcs11.C_EncryptUpdate(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">&quot;Incoming data 1&quot;</span>), <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">16</span>))]);
enc = Buffer.concat([enc, pkcs11.C_EncryptUpdate(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">&quot;Incoming data N&quot;</span>), <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">16</span>))]);
enc = Buffer.concat([enc, pkcs11.C_EncryptFinal(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">16</span>))]);

<span class="hljs-built_in">console</span>.log(enc.toString(<span class="hljs-string">&quot;hex&quot;</span>));</code></pre>
				<p>Decrypting data with AES-CBC mechanism</p>
				<pre><code class="language-javascript">pkcs11.C_DecryptInit(
    session,
    {
        <span class="hljs-attr">mechanism</span>: pkcs11js.CKM_AES_CBC,
        <span class="hljs-attr">parameter</span>: cbc_param
    },
    secretKey
);

<span class="hljs-keyword">var</span> dec = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">0</span>);
dec = Buffer.concat([dec, pkcs11.C_DecryptUpdate(session, enc, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">32</span>))]);
dec = Buffer.concat([dec, pkcs11.C_DecryptFinal(session, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">16</span>))]);

<span class="hljs-built_in">console</span>.log(dec.toString());</code></pre>
				<a href="#example-9" id="example-9" style="color: inherit; text-decoration: none;">
					<h3>Example #9</h3>
				</a>
				<p>Deriving key with ECDH mechanism</p>
				<pre><code class="language-javascript"><span class="hljs-comment">// Receive public data from EC public key</span>
<span class="hljs-keyword">var</span> attrs = pkcs11.C_GetAttributeValue(session, publicKeyEC, [{ <span class="hljs-attr">type</span>: pkcs11js.CKA_EC_POINT }])
<span class="hljs-keyword">var</span> ec = attrs[<span class="hljs-number">0</span>].value;

<span class="hljs-keyword">var</span> derivedKey = pkcs11.C_DeriveKey(
    session,
    {
        <span class="hljs-attr">mechanism</span>: pkcs11js.CKM_ECDH1_DERIVE,
        <span class="hljs-attr">parameter</span>: {
            <span class="hljs-attr">type</span>: pkcs11js.CK_PARAMS_EC_DH,
            <span class="hljs-attr">kdf</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">publicData</span>: ec
        }
    },
    privateKeyEC,
    [
        { <span class="hljs-attr">type</span>: pkcs11js.CKA_CLASS, <span class="hljs-attr">value</span>: pkcs11js.CKO_SECRET_KEY },
        { <span class="hljs-attr">type</span>: pkcs11js.CKA_TOKEN, <span class="hljs-attr">value</span>: <span class="hljs-literal">false</span> },
        { <span class="hljs-attr">type</span>: pkcs11js.CKA_KEY_TYPE, <span class="hljs-attr">value</span>: pkcs11js.CKK_AES },
        { <span class="hljs-attr">type</span>: pkcs11js.CKA_LABEL, <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;Derived AES key&quot;</span> },
        { <span class="hljs-attr">type</span>: pkcs11js.CKA_ENCRYPT, <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> },
        { <span class="hljs-attr">type</span>: pkcs11js.CKA_VALUE_LEN, <span class="hljs-attr">value</span>: <span class="hljs-number">256</span> / <span class="hljs-number">8</span> }
    ]
);</code></pre>
				<a href="#example-10" id="example-10" style="color: inherit; text-decoration: none;">
					<h3>Example #10</h3>
				</a>
				<p>Initializing NSS crypto library</p>
				<p>Use <code>options</code> parameter for <code>C_Initialize</code> function.</p>
				<p><strong>Type</strong></p>
				<pre><code class="language-ts"><span class="hljs-keyword">interface</span> InitializationOptions {
    <span class="hljs-comment">/**
     * NSS library parameters
     */</span>
    libraryParameters?: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * bit flags specifying options for `C_Initialize`
     * - CKF_LIBRARY_CANT_CREATE_OS_THREADS. True if application threads which are executing calls to the library
     *   may not use native operating system calls to spawn new threads; false if they may
     * - CKF_OS_LOCKING_OK. True if the library can use the native operation system threading model for locking;
     *   false otherwise
     */</span>
    flags?: <span class="hljs-built_in">number</span>;
}
<span class="hljs-comment">/**
 * Initializes the Cryptoki library
 * <span class="hljs-doctag">@param </span>options Initialization options
 * Supports implementation of standard `CK_C_INITIALIZE_ARGS` and extended NSS format.
 * - if `options` is null or empty, it calls native `C_Initialize` with `NULL`
 * - if `options` doesn&#x27;t have `libraryParameters`, it uses `CK_C_INITIALIZE_ARGS` structure
 * - if `options` has `libraryParameters`, it uses extended NSS structure
 */</span>
C_Initialize(options?: InitializationOptions): <span class="hljs-built_in">void</span>;</code></pre>
				<p><strong>Code</strong></p>
				<pre><code class="language-js"><span class="hljs-keyword">const</span> mod = <span class="hljs-keyword">new</span> pkcs11.PKCS11();
mod.load(<span class="hljs-string">&quot;/usr/local/opt/nss/lib/libsoftokn3.dylib&quot;</span>);

mod.C_Initialize({
    <span class="hljs-attr">libraryParameters</span>: <span class="hljs-string">&quot;configdir=&#x27;&#x27; certPrefix=&#x27;&#x27; keyPrefix=&#x27;&#x27; secmod=&#x27;&#x27; flags=readOnly,noCertDB,noModDB,forceOpen,optimizeSpace&quot;</span>,
});

<span class="hljs-comment">// Your code here</span>

mod.C_Finalize();</code></pre>
				<p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/Reference/FC_Initialize">More</a> info about NSS params for <code>C_Initialize</code></p>
				<a href="#suitability" id="suitability" style="color: inherit; text-decoration: none;">
					<h2>Suitability</h2>
				</a>
				<p>At this time this solution should be considered suitable for research and experimentation, further code and security review is needed before utilization in a production application.</p>
				<a href="#bug-reporting" id="bug-reporting" style="color: inherit; text-decoration: none;">
					<h2>Bug Reporting</h2>
				</a>
				<p>Please report bugs either as pull requests or as issues in the issue tracker. Graphene has a full disclosure vulnerability policy. Please do NOT attempt to report any security vulnerability in this code privately to anybody.</p>
				<a href="#related" id="related" style="color: inherit; text-decoration: none;">
					<h2>Related</h2>
				</a>
				<ul>
					<li><a href="http://docs.oasis-open.org/pkcs11/pkcs11-curr/v2.40/pkcs11-curr-v2.40.html">PKCS #11 2.40 Specification</a></li>
					<li><a href="http://www.cryptsoft.com/pkcs11doc/">Many PKCS #11 Specifications</a></li>
					<li><a href="http://www.lsv.ens-cachan.fr/Publis/PAPERS/PDF/BCFS-ccs10.pdf">Attacking and Fixing PKCS#11 Security Tokens</a></li>
					<li><a href="https://github.com/dotse/p5-crypt-pkcs11">PERL PKCS #11 binding</a></li>
					<li><a href="https://github.com/jariq/Pkcs11Interop">.NET PKCS #11 binding</a></li>
					<li><a href="https://github.com/larskanis/pkcs11">Ruby PKCS #11 binding</a></li>
					<li><a href="https://github.com/ANSSI-FR/caml-crush">OCaml PKCS #11 binding</a></li>
					<li><a href="https://github.com/ANSSI-FR/opkcs11-tool">OCaml PKCS #11 CLI</a></li>
					<li><a href="https://github.com/miekg/pkcs11">Go PKCS #11 binding</a> </li>
					<li><a href="http://www.pkcs11admin.net">PKCS #11 Admin</a></li>
					<li><a href="https://github.com/node-ffi/node-ffi">Node.js Foreign Function Interface</a></li>
					<li><a href="https://github.com/romanovskiy-k/pkcs11/blob/master/rtpkcs11t.h">GOST PKCS#11 constants</a></li>
					<li><a href="https://github.com/jariq/pkcs11-logger">PKCS#11 logging proxy module</a></li>
					<li><a href="https://github.com/iksaif/pkcs11-proxy">PKCS#11 Proxy</a></li>
					<li><a href="https://github.com/google/pkcs11test">PKCS#11 Tests</a></li>
					<li><a href="http://sourceforge.net/projects/opencryptoki/">OpenCryptoKi</a></li>
					<li><a href="https://www.opendnssec.org/softhsm/">SoftHSM</a></li>
					<li><a href="https://github.com/disig/SoftHSM2-for-Windows/">SofHSM2 for Windows</a></li>
					<li><a href="https://github.com/santigimeno/node-pcsclite">node-pcsc</a></li>
					<li><a href="https://tools.ietf.org/html/rfc7512">PKCS#11 URIs</a></li>
					<li><a href="http://www.keylength.com/en/compare/">Key Length Recommendations</a></li>
				</ul>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_index_d_.html">&quot;index.d&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>